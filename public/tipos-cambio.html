<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">Loading... - Tipos de Cambio</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="/css/app-theme.css" rel="stylesheet">
    <!-- Favicons -->
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon.png">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon.png">
    <style>
        :root {
            --sap-blue: #0070E0;
            --sap-dark-blue: #003B6B;
            --sap-white: #FFFFFF;
            --sap-text: #32363A;
            --sap-success: #107E3E;
            --sap-error: #E74C3C;
            --sap-warning: #F39C12;
            --sap-light-gray: #F8F9FA;
            --sap-border: #E5E5E5;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: '72', 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--sap-light-gray);
            color: var(--sap-text);
            line-height: 1.6;
        }

        .header {
            background: linear-gradient(135deg, var(--sap-dark-blue) 0%, var(--sap-blue) 100%);
            color: white;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
        }

        .header-subtitle {
            font-size: 14px;
            opacity: 0.9;
            margin-top: 4px;
        }

        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: var(--sap-blue);
            color: white;
        }

        .btn-primary:hover {
            background: var(--sap-dark-blue);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: transparent;
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .btn-secondary:hover {
            background: rgba(255,255,255,0.1);
        }

        .btn-success {
            background: var(--sap-success);
            color: white;
        }

        .btn-success:hover {
            background: #0E6B35;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .exchange-rate-controls {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            align-items: end;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-size: 12px;
            font-weight: 600;
            color: var(--sap-text);
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-group select,
        .form-group input {
            padding: 10px;
            border: 1px solid var(--sap-border);
            border-radius: 4px;
            font-size: 14px;
            background: white;
        }

        .form-group select:focus,
        .form-group input:focus {
            outline: none;
            border-color: var(--sap-blue);
            box-shadow: 0 0 0 2px rgba(0, 112, 224, 0.2);
        }

        .alert {
            padding: 12px 16px;
            border-radius: 4px;
            margin-bottom: 20px;
            font-size: 14px;
            display: none;
        }

        .alert.success {
            background: #D4F5D4;
            border: 1px solid var(--sap-success);
            color: var(--sap-success);
        }

        .alert.error {
            background: #FFE6E6;
            border: 1px solid var(--sap-error);
            color: var(--sap-error);
        }

        .alert.warning {
            background: #FFF3CD;
            border: 1px solid var(--sap-warning);
            color: #856404;
        }

        .exchange-rates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .country-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border: 1px solid var(--sap-border);
        }

        .country-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--sap-border);
        }

        .country-name {
            font-size: 18px;
            font-weight: 600;
            color: var(--sap-dark-blue);
        }

        .country-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-success {
            background: #D4F5D4;
            color: var(--sap-success);
        }

        .status-error {
            background: #FFE6E6;
            color: var(--sap-error);
        }

        .status-warning {
            background: #FFF3CD;
            color: #856404;
        }

        .exchange-rate-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border: 1px solid var(--sap-border);
            border-radius: 4px;
            margin-bottom: 8px;
            background: var(--sap-light-gray);
        }

        .currency-info {
            display: flex;
            flex-direction: column;
        }

        .currency-code {
            font-size: 16px;
            font-weight: 600;
            color: var(--sap-dark-blue);
        }

        .currency-date {
            font-size: 12px;
            color: #666;
        }

        .exchange-rate-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--sap-blue);
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
            color: var(--sap-blue);
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid var(--sap-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .country-source {
            font-size: 12px;
            color: #666;
            margin-top: 10px;
            font-style: italic;
        }

        .update-indicator {
            font-size: 11px;
            color: #666;
            margin-top: 5px;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }

        @media (max-width: 768px) {
            .controls-grid {
                grid-template-columns: 1fr;
            }
            
            .exchange-rates-grid {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .header-actions {
                flex-wrap: wrap;
                justify-content: center;
            }
        }
    </style>
    <!-- Session Manager para renovaci√≥n autom√°tica -->
    <script src="/js/sessionManager.js"></script>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div>
                <h1>Tipos de Cambio</h1>
                <div class="header-subtitle">Sistema de Consulta Multi-Compa√±√≠a <span id="systemName">Loading...</span></div>
            </div>
            <div class="header-actions">
                <a href="/dashboard" class="btn btn-secondary">‚Üê Volver al Dashboard</a>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container">
        <!-- Alert Messages -->
        <div id="alert" class="alert"></div>

        <!-- Controls -->
        <div class="exchange-rate-controls">
            <div class="controls-grid">
                <div class="form-group">
                    <label>Pa√≠s</label>
                    <select id="countrySelect">
                        <option value="ALL">üåé Todos los Pa√≠ses</option>
                        <option value="COSTA_RICA">üá®üá∑ Costa Rica</option>
                        <option value="HONDURAS">üá≠üá≥ Honduras</option>
                        <option value="GUATEMALA">üá¨üáπ Guatemala</option>
                        <option value="PANAMA">üáµüá¶ Panam√°</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Base de Datos</label>
                    <select id="companyDBSelect">
                        <option value="">Seleccionar...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>√öltima Actualizaci√≥n</label>
                    <input type="text" id="lastUpdateInfo" readonly placeholder="No disponible">
                </div>
                <div class="form-group">
                    <button onclick="fetchExchangeRates()" class="btn btn-primary" id="fetchBtn">
                        üìä Consultar Tipos de Cambio
                    </button>
                </div>
            </div>
        </div>

        <!-- Loading Indicator -->
        <div id="loading" class="loading" style="display: none;">
            <div class="spinner"></div>
            Cargando tipos de cambio...
        </div>

        <!-- Exchange Rates Display -->
        <div id="exchangeRatesContainer" class="exchange-rates-grid">
            <div class="no-data">
                <h3>üí± Tipos de Cambio</h3>
                <p>Seleccione un pa√≠s y base de datos para consultar los tipos de cambio actuales.</p>
            </div>
        </div>
    </div>

    <script>
        let sapAuth = null;
        let currentExchangeRates = {};

        // Initialize page
        // Load app configuration
        async function loadAppConfig() {
            try {
                const response = await fetch('/api/config');
                const config = await response.json();
                
                // Update app name in all locations
                document.getElementById('pageTitle').textContent = `${config.appName} - Tipos de Cambio`;
                document.getElementById('systemName').textContent = config.appName;
                
                console.log('App configuration loaded:', config);
            } catch (error) {
                console.error('Error loading app configuration:', error);
                // Fallback to default
                const fallbackName = 'My Application';
                document.getElementById('pageTitle').textContent = `${fallbackName} - Tipos de Cambio`;
                document.getElementById('systemName').textContent = fallbackName;
            }
        }

        document.addEventListener('DOMContentLoaded', async () => {
            await loadAppConfig();
            console.log('Exchange rates page loaded');
            
            // Check authentication
            const authData = localStorage.getItem('sapAuth');
            if (!authData) {
                showAlert('No se encontr√≥ sesi√≥n activa. Redirigiendo al login...', 'error');
                setTimeout(() => window.location.href = '/login', 2000);
                return;
            }

            try {
                sapAuth = JSON.parse(authData);
                console.log('Authentication data loaded:', sapAuth);
                
                // Populate company database dropdown
                populateCompanyDBDropdown();
                
                // Auto-load exchange rates for all countries
                setTimeout(() => {
                    fetchExchangeRates();
                }, 500);
                
            } catch (error) {
                console.error('Error parsing authentication data:', error);
                showAlert('Error al cargar datos de autenticaci√≥n', 'error');
            }
        });

        // Populate company database dropdown
        function populateCompanyDBDropdown() {
            const select = document.getElementById('companyDBSelect');
            select.innerHTML = '<option value="">üåé Todas las Bases de Datos</option>';

            if (sapAuth && sapAuth.sessions) {
                Object.keys(sapAuth.sessions).forEach(companyDB => {
                    const session = sapAuth.sessions[companyDB];
                    if (session && session.success) {
                        const option = document.createElement('option');
                        option.value = companyDB;
                        option.textContent = getCompanyDisplayName(companyDB);
                        select.appendChild(option);
                    }
                });
            }
        }

        // Get display name for company
        function getCompanyDisplayName(companyDB) {
            const names = {
                'SBO_GT_STIA_PROD': 'üá¨üáπ Guatemala',
                'SBO_HO_STIA_PROD': 'üá≠üá≥ Honduras',
                'SBO_PA_STIA_PROD': 'üáµüá¶ Panam√°',
                'SBO_STIACR_PROD': 'üá®üá∑ Costa Rica'
            };
            return names[companyDB] || companyDB;
        }

        // Get session for company
        function getSessionForCompany(companyDB) {
            if (!sapAuth || !sapAuth.sessions) return null;
            
            const session = sapAuth.sessions[companyDB];
            if (session && session.success) {
                return {
                    companyDB: companyDB,
                    sessionId: session.sessionId,
                    success: session.success
                };
            }
            return null;
        }

        // Show alert message
        function showAlert(message, type = 'error') {
            const alert = document.getElementById('alert');
            alert.className = `alert ${type}`;
            alert.textContent = message;
            alert.style.display = 'block';
            
            setTimeout(() => {
                alert.style.display = 'none';
            }, 5000);
        }

        // Fetch exchange rates
        async function fetchExchangeRates() {
            const country = document.getElementById('countrySelect').value;
            const companyDB = document.getElementById('companyDBSelect').value;
            const fetchBtn = document.getElementById('fetchBtn');
            const loading = document.getElementById('loading');
            const container = document.getElementById('exchangeRatesContainer');

            if (!sapAuth || !sapAuth.sessions) {
                showAlert('No hay sesiones SAP activas', 'error');
                return;
            }

            fetchBtn.disabled = true;
            fetchBtn.textContent = 'Consultando...';
            loading.style.display = 'flex';
            container.innerHTML = '';

            try {
                if (country === 'ALL') {
                    await fetchMultiCountryRates(companyDB);
                } else {
                    await fetchSingleCountryRates(country, companyDB);
                }
                
                updateLastUpdateInfo();
                
            } catch (error) {
                console.error('Error fetching exchange rates:', error);
                showAlert('Error al consultar tipos de cambio: ' + error.message, 'error');
                
                container.innerHTML = `
                    <div class="no-data">
                        <h3>‚ùå Error</h3>
                        <p>No se pudieron cargar los tipos de cambio.</p>
                        <p><small>${error.message}</small></p>
                    </div>
                `;
            } finally {
                fetchBtn.disabled = false;
                fetchBtn.textContent = 'üìä Consultar Tipos de Cambio';
                loading.style.display = 'none';
            }
        }

        // Fetch single country rates
        async function fetchSingleCountryRates(country, companyDB) {
            const session = companyDB ? getSessionForCompany(companyDB) : getAnyActiveSession();
            
            if (!session) {
                throw new Error('No hay sesi√≥n activa para la base de datos seleccionada');
            }

            const response = await fetchWithAutoRenewal('/api/sap/exchange-rates', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    sessionId: session.sessionId,
                    country: country,
                    companyDB: session.companyDB
                })
            });

            const result = await response.json();
            
            if (result.success) {
                currentExchangeRates[country] = result;
                displayCountryRates(country, result);
                // showUpdateSAPButton(); // Disabled - button removed
            } else {
                throw new Error(result.error || 'Error desconocido');
            }
        }

        // Fetch multi-country rates
        async function fetchMultiCountryRates(companyDB) {
            const session = companyDB ? getSessionForCompany(companyDB) : getAnyActiveSession();
            
            if (!session) {
                throw new Error('No hay sesi√≥n activa para la base de datos seleccionada');
            }

            const response = await fetchWithAutoRenewal('/api/sap/exchange-rates/multi-country', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    sessionId: session.sessionId,
                    countries: ['COSTA_RICA', 'HONDURAS', 'GUATEMALA', 'PANAMA'],
                    companyDB: session.companyDB
                })
            });

            const result = await response.json();
            
            if (result.success) {
                currentExchangeRates = result.results || {};
                
                // Display results
                Object.keys(currentExchangeRates).forEach(country => {
                    displayCountryRates(country, currentExchangeRates[country]);
                });
                
                // Display errors if any
                if (result.errors) {
                    Object.keys(result.errors).forEach(country => {
                        displayCountryError(country, result.errors[country]);
                    });
                }

                // showUpdateSAPButton(); // Disabled - button removed
                showAlert(`Tipos de cambio cargados: ${result.successCount} pa√≠ses exitosos, ${result.errorCount} errores`, 'success');
            } else {
                throw new Error(result.error || 'Error desconocido');
            }
        }

        // Get any active session
        function getAnyActiveSession() {
            if (!sapAuth || !sapAuth.sessions) return null;
            
            for (const companyDB of Object.keys(sapAuth.sessions)) {
                const session = sapAuth.sessions[companyDB];
                if (session && session.success) {
                    return {
                        companyDB: companyDB,
                        sessionId: session.sessionId,
                        success: session.success
                    };
                }
            }
            return null;
        }

        // Display country rates
        function displayCountryRates(country, data) {
            const container = document.getElementById('exchangeRatesContainer');

            const countryCard = document.createElement('div');
            countryCard.className = 'country-card';

            // Determinar el estado
            let statusBadge = '<div class="country-status status-success">‚úì Activo</div>';
            let cacheWarning = '';

            if (data.cached && data.stale) {
                statusBadge = '<div class="country-status status-warning">‚ö†Ô∏è Datos en Cach√©</div>';
                cacheWarning = `
                    <div class="alert warning" style="display: block; margin-top: 10px; font-size: 12px;">
                        ‚ö†Ô∏è Datos del cach√© (${data.cacheAge || 'desconocido'}).
                        El servicio BCCR tiene l√≠mite de tasa. Los datos se actualizar√°n autom√°ticamente cuando sea posible.
                    </div>
                `;
            } else if (data.rateLimitExceeded) {
                statusBadge = '<div class="country-status status-error">‚ö†Ô∏è L√≠mite Alcanzado</div>';
                cacheWarning = `
                    <div class="alert error" style="display: block; margin-top: 10px; font-size: 12px;">
                        ‚ö†Ô∏è L√≠mite de solicitudes del BCCR alcanzado. Por favor espere 15 minutos antes de intentar nuevamente.
                    </div>
                `;
            }

            countryCard.innerHTML = `
                <div class="country-header">
                    <div class="country-name">${getCountryDisplayName(country)}</div>
                    ${statusBadge}
                </div>

                ${cacheWarning}

                <div class="exchange-rates-list">
                    ${data.data ? data.data.map(rate => `
                        <div class="exchange-rate-item">
                            <div class="currency-info">
                                <div class="currency-code">${rate.currency}</div>
                                <div class="currency-date">${formatDate(rate.date)}</div>
                            </div>
                            <div class="exchange-rate-value">${formatRate(rate.rate)}</div>
                        </div>
                    `).join('') : '<p>No hay datos disponibles</p>'}
                </div>

                <div class="country-source">
                    Fuente: ${getSourceDisplayName(data.source)}
                    ${data.cached ? ' (Cach√©)' : ''}
                </div>

                ${data.lastUpdate ? `
                    <div class="update-indicator">
                        √öltima actualizaci√≥n: ${formatDateTime(data.lastUpdate)}
                    </div>
                ` : ''}

                <div class="btn-group">
                    <button onclick="refreshCountryRates('${country}')" class="btn btn-secondary btn-small">
                        üîÑ Actualizar
                    </button>
                </div>
            `;

            container.appendChild(countryCard);
        }

        // Display country error
        function displayCountryError(country, error) {
            const container = document.getElementById('exchangeRatesContainer');
            
            const countryCard = document.createElement('div');
            countryCard.className = 'country-card';
            countryCard.innerHTML = `
                <div class="country-header">
                    <div class="country-name">${getCountryDisplayName(country)}</div>
                    <div class="country-status status-error">‚ùå Error</div>
                </div>
                
                <div class="no-data">
                    <p><strong>Error:</strong> ${error.error}</p>
                    ${error.details ? `<p><small>${error.details}</small></p>` : ''}
                </div>
                
                <div class="btn-group">
                    <button onclick="refreshCountryRates('${country}')" class="btn btn-secondary btn-small">
                        üîÑ Reintentar
                    </button>
                </div>
            `;
            
            container.appendChild(countryCard);
        }

        // Get country display name
        function getCountryDisplayName(country) {
            const names = {
                'COSTA_RICA': 'Costa Rica üá®üá∑',
                'HONDURAS': 'Honduras üá≠üá≥',
                'GUATEMALA': 'Guatemala üá¨üáπ',
                'PANAMA': 'Panam√° üáµüá¶'
            };
            return names[country] || country;
        }

        // Get source display name
        function getSourceDisplayName(source) {
            const sources = {
                'SAP_SERVICE_LAYER': 'SAP Service Layer',
                'BCCR_EXTERNAL_SERVICE': 'Banco Central de Costa Rica (BCCR)',
                'MANUAL_INPUT': 'Entrada Manual',
                'OFFICIAL_RATE': 'Tipo Oficial'
            };
            return sources[source] || source;
        }

        // Format rate
        function formatRate(rate) {
            return new Intl.NumberFormat('es-CR', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 4
            }).format(rate);
        }

        // Format date
        function formatDate(dateString) {
            if (!dateString) {
                console.warn('formatDate: dateString is empty or null');
                return 'N/A';
            }

            try {
                console.log('formatDate: Attempting to format:', dateString, 'Type:', typeof dateString);
                const date = new Date(dateString);

                // Verificar si la fecha es v√°lida
                if (isNaN(date.getTime())) {
                    console.error('formatDate: Invalid date:', dateString);
                    return 'N/A';
                }

                const formatted = date.toLocaleDateString('es-CR', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit'
                });
                console.log('formatDate: Successfully formatted to:', formatted);
                return formatted;
            } catch (error) {
                console.error('formatDate: Error formatting date:', dateString, error);
                return 'N/A';
            }
        }

        // Format date and time
        function formatDateTime(dateString) {
            if (!dateString) {
                return 'N/A';
            }

            try {
                const date = new Date(dateString);

                // Verificar si la fecha es v√°lida
                if (isNaN(date.getTime())) {
                    return 'N/A';
                }

                return date.toLocaleString('es-CR', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    hour12: false
                });
            } catch (error) {
                console.error('Error formatting datetime:', dateString, error);
                return 'N/A';
            }
        }

        // Refresh all rates
        async function refreshAllRates() {
            document.getElementById('countrySelect').value = 'ALL';
            document.getElementById('companyDBSelect').value = '';
            await fetchExchangeRates();
        }

        // Refresh country rates
        async function refreshCountryRates(country) {
            document.getElementById('countrySelect').value = country;
            await fetchExchangeRates();
        }

        // Show update SAP button (Disabled - button removed)
        // function showUpdateSAPButton() {
        //     const btn = document.getElementById('updateSAPBtn');
        //     btn.style.display = 'inline-flex';
        // }

        // Update rates in SAP (Disabled - button removed)
        /* async function updateRatesInSAP() {
            if (Object.keys(currentExchangeRates).length === 0) {
                showAlert('No hay tipos de cambio para actualizar', 'warning');
                return;
            }

            const updateBtn = document.getElementById('updateSAPBtn');
            updateBtn.disabled = true;
            updateBtn.textContent = 'üíæ Actualizando...';

            try {
                // Prepare rates for update
                const allRates = [];
                Object.keys(currentExchangeRates).forEach(country => {
                    const countryData = currentExchangeRates[country];
                    if (countryData.data) {
                        countryData.data.forEach(rate => {
                            allRates.push({
                                country: country,
                                currency: rate.currency,
                                rate: rate.rate,
                                date: rate.date
                            });
                        });
                    }
                });

                if (allRates.length === 0) {
                    showAlert('No hay tipos de cambio v√°lidos para actualizar', 'warning');
                    return;
                }

                const session = getAnyActiveSession();
                if (!session) {
                    showAlert('No hay sesi√≥n activa para actualizar SAP', 'error');
                    return;
                }

                const response = await fetchWithAutoRenewal('/api/sap/exchange-rates/update', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        sessionId: session.sessionId,
                        rates: allRates,
                        companyDB: session.companyDB
                    })
                });

                const result = await response.json();

                if (result.success) {
                    showAlert(`Tipos de cambio actualizados exitosamente: ${result.updatedCount}/${result.totalCount}`, 'success');
                } else {
                    showAlert('Error al actualizar tipos de cambio en SAP: ' + result.error, 'error');
                }

            } catch (error) {
                console.error('Error updating exchange rates in SAP:', error);
                showAlert('Error al actualizar tipos de cambio: ' + error.message, 'error');
            } finally {
                updateBtn.disabled = false;
                updateBtn.textContent = 'üíæ Actualizar en SAP';
            }
        } */

        // Update last update info
        function updateLastUpdateInfo() {
            const input = document.getElementById('lastUpdateInfo');
            const now = new Date();
            input.value = now.toLocaleString('es-CR');
        }

        console.log('Exchange rates page script loaded successfully');
    </script>

    <!-- Footer -->
    <footer class="main-footer">
        <div class="footer-content">
            <div class="footer-left">
                <span class="bluesystem-brand">BlueSystemIO</span>
                <span>2025</span>
            </div>
            <div class="footer-right">
                <span>Version 1.0.0</span>
            </div>
        </div>
    </footer>
    <!-- Inactivity Manager - Auto logout after 5 minutes of inactivity -->
    <script src="/js/inactivityManager.js"></script>
</body>
</html>